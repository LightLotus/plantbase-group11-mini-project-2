<!DOCTYPE HTML>
<html>

<head>
<meta charset="UTF-8">
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="./css/index.css" />
<title>Plant Identifier</title>
</head>

<body class="identifier">
   <!-- navbar starts here -->
<nav class="navbar navbar-expand-lg py-4">
  <div class="nav-container container-fluid p-0">
    <a class="navbar-brand" href="./index.html"
      ><img id="logo" src="./images/plantbase-logo.svg" alt=""
    /></a>
    <button
      class="hamburger-toggle"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span><i class="fa-solid fa-bars"></i></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="nav-link-container mx-auto mb-2 mb-lg-0">
        <li class="nav-link-items">
          <a aria-current="page" href="./index.html">Homepage</a>
        </li>
        <li class="dropdown nav-link-items">
          <a
            class="dropdown-toggle"
            href="./allplants.html"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Shop
          </a>
          <div class="shop-items dropdown-menu">
            <span><a href="allplants.html">All Plants</a></span>
            <span><hr class="dropdown-divider" /></span>
            <span>
              <a href="hangingplant.html">Hanging</a>
            </span>
            <span><a href="fern.html">Fern</a></span>
            <span><a href="bromeliad.html">Bromeliad</a></span>
            <span>
              <a href="cactus.html">Cactus & Succulent</a>
            </span>
            <span><a href="aglaonema.html">Aglaonema</a></span>
            <span><hr class="dropdown-divider" /></span>
            <span><a href="other.html">Other</a></span>
            <span><a href="flower.html">Flower</a></span>
            <span><a href="foliage.html">Foliage plant</a></span>
            <span><a href="anthurium.html">Anthurium</a></span>
            <span><a href="palm.html">Palm</a></span>
            <span><hr class="dropdown-divider" /></span>
            <span><a href="dieffenbachia.html">Dieffenbachia</a></span>
            <span>
              <a href="dracaena.html">Dracaena</a>
            </span>
            <span>
              <a href="ficus.html">Ficus</a>
            </span>
            <span>
              <a href="aralia.html">Aralia</a>
            </span>
            <span>
              <a href="philodendron.html">Philodendron</a>
            </span>
            <span><hr class="dropdown-divider" /></span>
            <span>
              <a href="grass.html">Grass</a>
            </span>
            <span>
              <a href="topiairy.html">Topiairy</a>
            </span>
            <span>
              <a href="sansevieria.html">Sansevieria</a>
            </span>
            <span>
              <a href="spathiphyllum.html">Spathiphyllum</a>
            </span>
            <span>
              <a href="schefflera.html">Schefflera</a>
            </span>
          </div>
        </li>
        <li class="nav-link-items">
          <a href="#">Blogs</a>
        </li>
        <li class="nav-link-items">
          <a href="#">FAQs</a>
        </li>
        <li class="nav-link-items">
          <a href="identifier.html">Plant Identifier</a>
        </li>
        <li class="nav-link-items">
          <a href="#">Contact Us</a>
        </li>
      </ul>
      <form class="search-form d-flex" role="search">
        <input
          class="search-input me-2"
          type="search"
          placeholder="Search"
        />
        <span class="search-icon"
          ><i class="fa-solid fa-magnifying-glass"></i
        ></span>
      </form>
      <ul class="nav-sign-in mb-2 mb-lg-0">
        <li>
          <a href="#">Login</a>
        </li>
        <span>/</span>
        <li>
          <a href="#">Sign Up</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<!-- navbar ends here -->

  <h1>PLANT BASE IDENTIFIER</h1>

  <div class="divForm">
  <form class="search-form" >
    <input type="file" multiple />
    <button id="search-btn" type="button" >Identify</button>
    <input class="reload" type="button" value="Reload" onClick="window.location.reload(true)">
  </form>
</div>
<div class="mainImage"></div>
  
  <hr>
 <div class="main-container">




 </div>
 <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
      integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"
      integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK"
      crossorigin="anonymous"
    ></script>

<script type="text/javascript">
  
document.querySelector('#search-btn').onclick = function sendIdentification() {
    const files = [...document.querySelector('input[type=file]').files];
    const promises = files.map((file) => {
      return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (event) => {
            const res = event.target.result;
            console.log(res);
            resolve(res);
            input = "";
          }
          reader.readAsDataURL(file)
          
       
      })
    })
    
    Promise.all(promises).then((base64files) => {
      console.log(base64files)
            
      const data = {
        // api_key: 'okMbPdmE10p9YNGwgXRg57x5d1fGIubAPvS3AKBUGYBd1CaxgT',
        // api_key: 'E9v6gnIZ1pVKmewFwQ61xQ9vbNfpmUXRDMdHy1qsrnJlhOAtSq',

        // api_key:'aRLxRcJm5RclUp5P3E6acUmUWCX9XjCe64qLKUyRsLsIkwBcdR', daniel john
        api_key:'2CYXqGzFtfjI3fbf3LFebC3YAOvJqvErUVVFiOXWx9cL2FtXDA',   
        images: base64files,
        // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
        modifiers: ["crops_fast", "similar_images"],
        plant_language: "en",
        // plant details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Plant-details
        plant_details: ["common_names",
                        "url",
                        "name_authority",
                        "wiki_description",
                        "taxonomy",
                        "synonyms"],
      };
      
      fetch('https://api.plant.id/v2/identify', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        const dataImage = data.images[0].url;
        const suggest = data.suggestions;
        // const plantDetails = data.suggestions[0].plant_details;
        // console.log(plantDetails);

      console.log(suggest);
        // map to get similar image
        const newSuggest = suggest.map((plant)=>{
          return plant.similar_images[0].url
         
        
        })

        // map to get plant names
        const newplantName = suggest.map((plant)=>{
          return plant.plant_name;
        })

        // map to get commom names
        const newPlantDetails = suggest.map((details)=>{
          return details.plant_details.common_names;
        })

        // this part is to view your local uploaded photo
        // const div = document.querySelector('.main-container')
        const divForm = document.querySelector('.divForm');
        const cardImageDiv = document.createElement('div');
        cardImageDiv.classList.add('card');
        const mainImage = document.querySelector('.mainImage');

       
        
     
        const localImage = document.createElement('img');
        localImage.classList.add('localImage');
        localImage.src = dataImage;
        cardImageDiv.append(localImage);
        mainImage.append(cardImageDiv);
        // cardImageDiv.append(localImageDiv);

        for (let i=0; (i<newSuggest.length)&&(i<newplantName.length)&&(i<newPlantDetails.length); i++){
          console.log(newSuggest[i])
          console.log(newplantName[i])
   

          const getPlantName = newplantName[i];
          const getimage = newSuggest[i];
          const getPlantDetails = newPlantDetails[i];

          console.log(getPlantDetails)
        
          // const getPlantDetails = info;
          const div = document.querySelector('.main-container')
          const wrapper = document.createElement('div');
          wrapper.classList.add('wrapper')
          const mainCardDiv = document.createElement('div')
          mainCardDiv.classList.add('mainCardDiv')

           // create a new div with a class of card
          const cardDiv = document.createElement('div');
          cardDiv.classList.add('card');

          // const pDiv = document.createElement('div')
          // const cardParagraph = document.createElement('p')

          // cardParagraph.classList.add('cardParagraphClass')
          // cardParagraph.innerHTML = getPlantName;

          // pDiv.append(cardParagraph);
          
          // cardDiv.append(pDiv);

           // plant details paragraph div
           const mainPlantDetailsDiv = document.createElement('div')
          mainPlantDetailsDiv.classList.add('mainPlantDetailsDiv')
          const plantDetailsParagraph = document.createElement('p')
          plantDetailsParagraph.classList.add('plantDetails')

          const plantName = document.createElement('p')
          plantName.classList.add('plantName')
          plantName.innerHTML = ('Name : ' + '' + getPlantName.toUpperCase());
          plantDetailsParagraph.innerHTML = ('Common Names:' + ' ' + getPlantDetails[0].toUpperCase());
          // plantDetailsParagraph.innerHTML = (getPlantDetails[0]);
          mainPlantDetailsDiv.append(plantName);
          mainPlantDetailsDiv.append(plantDetailsParagraph);
         


          const image = document.createElement('img');
          image.classList.add('image-url');
          image.src=getimage;
          const newAnchor = document.createElement('a');
          newAnchor.href = newSuggest;
          newAnchor.append(image);
          cardDiv.append(newAnchor);
          mainCardDiv.append(cardDiv);
          // div.append(mainCardDiv);
          wrapper.append(mainCardDiv)
          wrapper.append(mainPlantDetailsDiv);
          div.append(wrapper)


    
        }

      
     
     

 
        
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    })
  
};


</script>
</body>

</html>